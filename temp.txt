import javax.xml.stream.XMLInputFactory;
import javax.xml.stream.XMLEventReader;
import javax.xml.stream.events.XMLEvent;
import javax.xml.stream.events.StartElement;
import javax.xml.stream.events.Characters;
import javax.xml.stream.events.EndElement;
import javax.xml.stream.XMLStreamException;
import java.io.FileInputStream;
import java.util.Stack;

public class XmlProcessor {

    public void printFirstPAResponseTagsAndValues(String xmlFilePath) {
        XMLInputFactory xmlInputFactory = XMLInputFactory.newInstance();

        try {
            XMLEventReader reader = xmlInputFactory.createXMLEventReader(new FileInputStream(xmlFilePath));
            boolean insidePAResponse = false; // Flag to track if we're inside the PAResponse tag

            while (reader.hasNext()) {
                XMLEvent event = reader.nextEvent();
                if (event.isStartElement() && event.asStartElement().getName().getLocalPart().equals("PAResponse")) {
                    insidePAResponse = true;
                    Stack<String> tagPath = new Stack<>();
                    processNestedTags(reader, tagPath);
                } else if (event.isEndElement() && event.asEndElement().getName().getLocalPart().equals("PAResponse")) {
                    insidePAResponse = false;
                    break; // Stop after exiting the PAResponse tag
                }
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    private void processNestedTags(XMLEventReader reader, Stack<String> tagPath) throws XMLStreamException {
        while (reader.hasNext()) {
            XMLEvent event = reader.nextEvent();
            
            if (event.isStartElement()) {
                StartElement startElement = event.asStartElement();
                String tagName = startElement.getName().getLocalPart();
                tagPath.push(tagName);
            } else if (event.isCharacters()) {
                Characters characters = event.asCharacters();
                if (!characters.isWhiteSpace()) { // Ignore whitespace
                    String value = characters.getData();
                    String prefix = String.join("_", tagPath);
                    System.out.println(prefix + ": " + value);
                }
            } else if (event.isEndElement()) {
                EndElement endElement = event.asEndElement();
                String tagName = endElement.getName().getLocalPart();
                if (!tagPath.isEmpty() && tagName.equals(tagPath.peek())) {
                    tagPath.pop(); // Pop the tag from the stack when we reach its end tag
                }
            }
        }
    }
}
